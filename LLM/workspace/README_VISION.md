# 🎥 Vision Agent - 시각장애인을 위한 영상 장면 묘사 시스템

로봇개에 달린 카메라로 촬영된 영상을 분석하여 시각장애인에게 주변 환경을 상세히 묘사해주는 시스템입니다.

## 📋 시스템 구조

```
workspace/
├── agents/
│   ├── vision_agent.py      # Vision 분석 에이전트 정의
│   └── weather_agent.py     # 날씨 에이전트
├── services/
│   └── agent_runner.py      # ask_vision() 실행 로직
├── tools/
│   ├── video_processor.py   # 영상 → 프레임 추출
│   └── vision_api.py        # OpenAI Vision API 호출
├── input/                   # 테스트 영상 저장 폴더
│   └── sample.mp4          # 분석할 영상 파일
├── temp/                    # 추출된 프레임 임시 저장
└── main.py                  # 실행 진입점
```

## 🚀 사용 방법

### 1. 패키지 설치

```bash
pip install -r requirements.txt
```

### 2. 환경 변수 설정

`.env` 파일에 OpenAI API 키를 설정하세요:

```
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. 영상 파일 준비

`input/` 폴더에 분석할 영상 파일을 넣으세요:

```bash
# 예시
cp your_video.mp4 input/sample.mp4
```

### 4. 실행

```bash
python main.py
```

## ⚙️ 설정 변경

`main.py` 파일 상단의 설정을 수정하여 동작을 조정할 수 있습니다:

```python
# ========== 설정 ==========
FRAME_INTERVAL_SECONDS = 2  # 프레임 추출 간격 (초)
VIDEO_PATH = "input/sample.mp4"  # 분석할 영상 파일 경로
# ==========================
```

### 프레임 간격 조정 가이드

| 간격 | 1분 영상 시 프레임 수 | 권장 용도 | API 비용 |
|------|---------------------|----------|----------|
| 1초 | 60개 | 빠른 장면 전환 | 높음 |
| **2초** (기본) | 30개 | 일반적인 영상 | 중간 |
| 3초 | 20개 | 느린 변화 | 낮음 |
| 5초 | 12개 | 정적인 장면 | 매우 낮음 |

## 📊 출력 형식

시간대별로 장면이 상세히 묘사됩니다:

```
질문: 지금 뭐가 보여?

[Vision Agent] 영상 분석 시작
- 영상 경로: input/sample.mp4
- 프레임 간격: 2초

[0-2초]
실내 복도가 보입니다. 왼쪽에 문이 있고, 바닥은 흰색 타일입니다.
조명은 밝으며, 앞쪽으로 복도가 길게 이어집니다.

[2-4초]
복도를 따라 이동 중입니다. 오른쪽에 소화기가 보이고,
앞쪽에 계단 입구가 나타나기 시작합니다.

[4-6초]
계단을 내려가고 있습니다. 계단은 약 10개 정도이며,
손잡이가 양쪽에 설치되어 있습니다.
...
```

## 🔧 작동 원리

1. **프레임 추출** (`video_processor.py`)
   - OpenCV로 영상 로드
   - 설정된 간격(기본 2초)마다 프레임 추출
   - `temp/` 폴더에 이미지로 저장

2. **Vision API 분석** (`vision_api.py`)
   - 추출된 모든 프레임을 base64 인코딩
   - OpenAI GPT-4o Vision API에 배치 전송
   - 시간대별 장면 묘사 생성

3. **결과 반환 및 정리**
   - 시간대별 묘사를 사용자에게 반환
   - 임시 파일 자동 삭제

## 🎯 주요 기능

- ✅ 자동 프레임 추출 (설정 가능한 간격)
- ✅ 시간대별 상세 장면 묘사
- ✅ 시각장애인 친화적 설명
- ✅ 장애물 및 주의사항 감지
- ✅ 이전 프레임 대비 변화 추적
- ✅ 에러 처리 및 자동 정리

## 🐛 문제 해결

### 영상 파일을 찾을 수 없습니다
```
오류: 영상 파일을 찾을 수 없습니다: input/sample.mp4
영상 파일을 'input/' 폴더에 넣어주세요.
```
→ `input/` 폴더에 영상 파일이 있는지 확인하고, `VIDEO_PATH` 설정이 올바른지 확인하세요.

### 영상 파일이 손상되었습니다
```
오류: 영상 파일을 열 수 없습니다. 파일이 손상되었거나 지원하지 않는 형식입니다.
```
→ MP4, AVI, MOV 등 일반적인 영상 형식을 사용하세요. 영상을 다시 인코딩해보세요.

### API 키 오류
```
Vision API 호출 중 오류가 발생했습니다: ...
```
→ `.env` 파일의 `OPENAI_API_KEY`가 올바르게 설정되어 있는지 확인하세요.

## 💡 향후 개선 방향

1. **실시간 스트리밍**: 로봇개 카메라에서 실시간 영상 받기
2. **적응형 샘플링**: 장면 변화 감지 시에만 프레임 추출
3. **음성 출력**: TTS를 통한 음성 안내
4. **장애물 경고**: 위험 요소 실시간 알림

## 📝 라이센스

MIT License


